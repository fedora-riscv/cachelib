diff '--color=auto' -ruN CacheLib-bd22b0eb79f7e2326f77a22c278c48e454882291/cachelib/allocator/CMakeLists.txt CacheLib-bd22b0eb79f7e2326f77a22c278c48e454882291-fix_test_linking/cachelib/allocator/CMakeLists.txt
--- CacheLib-bd22b0eb79f7e2326f77a22c278c48e454882291/cachelib/allocator/CMakeLists.txt	2022-03-14 10:49:38.000000000 -0700
+++ CacheLib-bd22b0eb79f7e2326f77a22c278c48e454882291-fix_test_linking/cachelib/allocator/CMakeLists.txt	2022-03-15 14:00:37.874691691 -0700
@@ -77,7 +77,8 @@
         DESTINATION ${LIB_INSTALL_DIR} )
 
 if (BUILD_TESTS)
-  add_library (allocator_test_support
+  add_library (allocator_test_support OBJECT
+    ../common/TestUtils.cpp
     ${DATASTRUCT_TESTS_THRIFT_FILES}
     ./nvmcache/tests/NvmTestBase.cpp
     ./memory/tests/TestBase.cpp
diff '--color=auto' -ruN CacheLib-bd22b0eb79f7e2326f77a22c278c48e454882291/cachelib/benchmarks/CMakeLists.txt CacheLib-bd22b0eb79f7e2326f77a22c278c48e454882291-fix_test_linking/cachelib/benchmarks/CMakeLists.txt
--- CacheLib-bd22b0eb79f7e2326f77a22c278c48e454882291/cachelib/benchmarks/CMakeLists.txt	2022-03-14 10:49:38.000000000 -0700
+++ CacheLib-bd22b0eb79f7e2326f77a22c278c48e454882291-fix_test_linking/cachelib/benchmarks/CMakeLists.txt	2022-03-15 13:21:46.885003006 -0700
@@ -44,7 +44,7 @@
   add_test (CachelibTickerClockBench.cpp)
   add_test (CompactCacheBench.cpp)
   add_test (HashMapBenchmark.cpp)
-  add_test (ItemsReaperBench.cpp)
+  add_test (ItemsReaperBench.cpp allocator_test_support)
   add_test (tl-bench/main.cpp)
   add_test (MMTypeAccessBench.cpp)
   add_test (MMTypeBench.cpp)
diff '--color=auto' -ruN CacheLib-bd22b0eb79f7e2326f77a22c278c48e454882291/cachelib/common/CMakeLists.txt CacheLib-bd22b0eb79f7e2326f77a22c278c48e454882291-fix_test_linking/cachelib/common/CMakeLists.txt
--- CacheLib-bd22b0eb79f7e2326f77a22c278c48e454882291/cachelib/common/CMakeLists.txt	2022-03-14 10:49:38.000000000 -0700
+++ CacheLib-bd22b0eb79f7e2326f77a22c278c48e454882291-fix_test_linking/cachelib/common/CMakeLists.txt	2022-03-15 12:15:28.818925017 -0700
@@ -76,12 +76,12 @@
   add_test (tests/CohortTests.cpp)
   add_test (tests/CounterTests.cpp)
   add_test (tests/CountMinSketchTest.cpp)
-  add_test (tests/EventInterfaceTest.cpp cachelib_allocator)
+  add_test (tests/EventInterfaceTest.cpp allocator_test_support)
   add_test (tests/HashTests.cpp)
   add_test (tests/IteratorsTests.cpp)
   add_test (tests/MutexTests.cpp)
   add_test (tests/PeriodicWorkerTest.cpp)
-  add_test (tests/SerializationTest.cpp cachelib_allocator)
+  add_test (tests/SerializationTest.cpp allocator_test_support)
   add_test (tests/UtilTests.cpp)
   add_test (tests/CountDownLatchTest.cpp)
   add_test (tests/UtilTestsRSS.cpp)
diff '--color=auto' -ruN CacheLib-bd22b0eb79f7e2326f77a22c278c48e454882291/cachelib/compact_cache/CMakeLists.txt CacheLib-bd22b0eb79f7e2326f77a22c278c48e454882291-fix_test_linking/cachelib/compact_cache/CMakeLists.txt
--- CacheLib-bd22b0eb79f7e2326f77a22c278c48e454882291/cachelib/compact_cache/CMakeLists.txt	2022-03-14 10:49:38.000000000 -0700
+++ CacheLib-bd22b0eb79f7e2326f77a22c278c48e454882291-fix_test_linking/cachelib/compact_cache/CMakeLists.txt	2022-03-15 11:33:00.611186014 -0700
@@ -12,11 +12,10 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
-add_library (compact_cache_test_support INTERFACE)
-add_dependencies(compact_cache_test_support INTERFACE thrift_generated_files)
-
 if (BUILD_TESTS)
-  target_link_libraries (compact_cache_test_support INTERFACE
+  add_library (compact_cache_test_support OBJECT ../common/TestUtils.cpp)
+
+  target_link_libraries (compact_cache_test_support PUBLIC
     cachelib_allocator
     glog::glog
     gflags
